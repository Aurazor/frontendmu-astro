---
import LayoutSingleMeetup from "../../layouts/LayoutSingleMeetup.astro";
import MeetupSingle from "../../components/MeetupSingle.astro";
import { getDirectusClient } from "../../utils/directus-client";

const props = Astro.params;

export async function getStaticPaths() {
  const directus = await getDirectusClient();
  global.events = global.events
    ? global.events
    : await directus.items("Events").readByQuery({
        fields: ["*.*"],
      });

  return global.events.data.map((event) => {
    return {
      params: {
        id: event.id.toString(),
      },
    };
  });
}

// Get Data for the current meetup based on the id
const directus = await getDirectusClient();
global.meetup = {}
global.meetup[props.id] = global.meetup[props.id]
  ? global.meetup[props.id]
  : await directus.items("Events").readByQuery({
      filter: {
        id: {
          _eq: props.id,
        },
      },
      fields: ["*.*"],
    });

console.log(global.meetup[props.id])
const meetup = global.meetup[props.id].data[0];
---

<LayoutSingleMeetup title={meetup.title} description={meetup.description}>
  <MeetupSingle routeId={props.id} getCurrentEvent={meetup} />
</LayoutSingleMeetup>
